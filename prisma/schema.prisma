generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Cliente {
  id                Int        @id @default(autoincrement())
  nombreCompleto    String
  celular           String
  direccionNegocio  String?
  direccionVivienda String?
  fechaCreacion     DateTime
  prestamos         Prestamo[]
}

model Usuario {
  id             Int        @id @default(autoincrement())
  nombreCompleto String
  celular        String
  email          String     @unique
  alias          String?
  rol            Rol
  fechaCreacion  DateTime
  placaMoto      String?
  fechaTecnico   DateTime?
  fechaSoat      DateTime?
  password       String?
  abonos         Abono[]
  prestamos      Prestamo[] @relation("prestamosCobrador")
}

model Prestamo {
  id            Int      @id @default(autoincrement())
  clienteId     Int
  fechaInicio   DateTime
  montoPrestado Decimal
  tasa          Float
  cuotas        Int
  cobradorId    Int
  notas         String?
  orden         Int
  abonos        Abono[]
  cliente       Cliente  @relation(fields: [clienteId], references: [id])
  cobrador      Usuario  @relation("prestamosCobrador", fields: [cobradorId], references: [id])
}

model Abono {
  id         Int      @id @default(autoincrement())
  prestamoId Int
  cobradorId Int
  fecha      DateTime
  monto      Decimal
  tipoPago   String
  notas      String?
  cobrador   Usuario  @relation(fields: [cobradorId], references: [id])
  prestamo   Prestamo @relation(fields: [prestamoId], references: [id])
}

model Caja {
  id    Int            @id @default(autoincrement())
  fecha DateTime
  tipo  MovimientoTipo
  monto Decimal
  nota  String?
}

enum Rol {
  ADMIN
  COBRADOR
}

enum MovimientoTipo {
  GASTO
  ENTRADA
  SALIDA
  SALIDA_RUTA
  ENTRADA_RUTA
}
